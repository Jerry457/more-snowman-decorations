local SnowmanSkins = {
    -- 颜色需要配置
    dungball = {
        colour = {0/255, 0/255, 0/255, 0},
    },
    tumbleweed = {
        colour = {0/255, 0/255, 0/255, 0},
    },
    icecream = {
        colour = {0/255, 0/255, 0/255, 0},
    },
    invisible = {
        colour = {0/255, 0/255, 0/255, 0},
    },
    meatball = {
        colour = {0/255, 0/255, 0/255, 0},
    },
    coconut = {
        colour = {0/255, 0/255, 0/255, 0},
    },
}

local MoreDecorations = {
    watermelon = { canflip = true },
    shortcake = { canflip = true },
    watermelon_cooked = { canflip = true },
    asparagus_cooked = { canflip = true },
    winter_ornament_plain1 = { canflip = true },
    winter_ornament_plain2 = { canflip = true },
    winter_ornament_plain3 = { canflip = true },
    winter_ornament_plain4 = { canflip = true },
    winter_ornament_plain5 = { canflip = true },
    winter_ornament_plain6 = { canflip = true },
    winter_ornament_plain7 = { canflip = true },
    winter_ornament_plain8 = { canflip = true },
    winter_ornament_plain9 = { canflip = true },
    winter_ornament_plain10 = { canflip = true },
    winter_ornament_plain11 = { canflip = true },
    winter_ornament_plain12 = { canflip = true },
    winter_ornament_fancy1 = { canflip = true },
    winter_ornament_fancy2 = { canflip = true },
    winter_ornament_fancy3 = { canflip = true },
    winter_ornament_fancy4 = { canflip = true },
    winter_ornament_fancy5 = { canflip = true },
    winter_ornament_fancy6 = { canflip = true },
    winter_ornament_fancy7 = { canflip = true },
    winter_ornament_fancy8 = { canflip = true },
    winter_ornament_boss_antlion = { canflip = true },
    winter_ornament_boss_bearger = { canflip = true },
    winter_ornament_boss_beequeen = { canflip = true },
    winter_ornament_boss_celestialchampion1 = { canflip = true },
    winter_ornament_boss_celestialchampion2 = { canflip = true },
    winter_ornament_boss_celestialchampion3 = { canflip = true },
    winter_ornament_boss_celestialchampion4 = { canflip = true },
    winter_ornament_boss_crabkingpearl = { canflip = true },
    winter_ornament_boss_crabking = { canflip = true },
    winter_ornament_boss_daywalker2 = { canflip = true },
    winter_ornament_boss_daywalker = { canflip = true },
    winter_ornament_boss_deerclops = { canflip = true },
    winter_ornament_boss_dragonfly = { canflip = true },
    winter_ornament_boss_eyeofterror1 = { canflip = true },
    winter_ornament_boss_eyeofterror2 = { canflip = true },
    winter_ornament_boss_fuelweaver = { canflip = true },
    winter_ornament_boss_klaus = { canflip = true },
    winter_ornament_boss_krampus = { canflip = true },
    winter_ornament_boss_malbatross = { canflip = true },
    winter_ornament_boss_minotaur = { canflip = true },
    winter_ornament_boss_moose = { canflip = true },
    winter_ornament_boss_mutatedbearger = { canflip = true },
    winter_ornament_boss_mutateddeerclops = { canflip = true },
    winter_ornament_boss_mutatedwarg = { canflip = true },
    winter_ornament_boss_noeyeblue = { canflip = true },
    winter_ornament_boss_noeyered = { canflip = true },
    winter_ornament_boss_sharkboi = { canflip = true },
    winter_ornament_boss_toadstool = { canflip = true },
    winter_ornament_boss_toadstool_misery = { canflip = true },
    winter_ornament_boss_wagstaff = { canflip = true },
    winter_ornament_boss_wormboss = { canflip = true },
    winter_ornament_shadowthralls = { canflip = true },
    winter_ornament_boss_hermithouse = { canflip = true },
    winter_ornament_boss_pearl = { canflip = true },
    winter_ornament_festivalevents1 = { canflip = true },
    winter_ornament_festivalevents2 = { canflip = true },
    winter_ornament_festivalevents3 = { canflip = true },
    winter_ornament_festivalevents4 = { canflip = true },
    winter_ornament_festivalevents5 = { canflip = true },
    winter_food1 = { canflip = true },
    winter_food2 = { canflip = true },
    winter_food3 = { canflip = true },
    winter_food4 = { canflip = true },
    winter_food5 = { canflip = true },
    winter_food6 = { canflip = true },
    winter_food7 = { canflip = true },
    winter_food8 = { canflip = true },
    winter_food9 = { canflip = true },
    halloween_ornament_1 = { canflip = true },
    halloween_ornament_2 = { canflip = true },
    halloween_ornament_3 = { canflip = true },
    halloween_ornament_4 = { canflip = true },
    halloween_ornament_5 = { canflip = true },
    halloween_ornament_6 = { canflip = true },
    mutator_dropper = { canflip = true },
    mutator_healer = { canflip = true },
    mutator_hider = { canflip = true },
    mutator_moon = { canflip = true },
    mutator_spitter = { canflip = true },
    mutator_warrior = { canflip = true },
    mutator_water = { canflip = true },
    papyrus = { canflip = true },
    pigskin = { canflip = true },
    rope = { canflip = true },
    silk = { canflip = true },
    spiderden_bedazzler = { canflip = true },
    spidereggsack = { canflip = true },
    spidergland = { canflip = true },
    spider_healer_item = { canflip = true },
    spider_repellent = { canflip = true },
    spider_whistle = { canflip = true },
    batwing_cooked = { canflip = true },
    boards = { canflip = true },
    cookedmandrake = { canflip = true },
    cookedmeat = { canflip = true },
    cookedmonstermeat = { canflip = true },
    cookedsmallmeat = { canflip = true },
    coontail = { canflip = true },
    crumbs = { canflip = true },
    dragon_scales = { canflip = true },
    drumstick_cooked = { canflip = true },
    drumstick = { canflip = true },
    fishmeat_cooked = { canflip = true },
    foliage = { canflip = true },
    honeycomb = { canflip = true },
    livinglog = { canflip = true },
    log = { canflip = true },
    lunarplant_husk = { canflip = true },
    mandrake = { canflip = true },
    meat = { canflip = true },
    messagebottleempty = { canflip = true },
    monstermeat = { canflip = true },
    moon_cap_cooked = { canflip = true },
    moon_cap = { canflip = true },
    plantmeat_cooked = { canflip = true },
    plantmeat = { canflip = true },
    reviver = { canflip = true },
    smallmeat = { canflip = true },
    watermelon = { canflip = true },
    waxpaper = { canflip = true },
    acorn_cooked = { canflip = true },
    acorn = { canflip = true },
    batnose_cooked = { canflip = true },
    batnose = { canflip = true },
    beefalowool = { canflip = true },
    beeswax = { canflip = true },
    bird_egg_cooked = { canflip = true },
    bird_egg = { canflip = true },
    butterflywings = { canflip = true },
    carnival_prizeticket = { canflip = true },
    carrot_cooked = { canflip = true },
    compostwrap = { canflip = true },
    compost = { canflip = true },
    cookiecuttershell = { canflip = true },
    corn_cooked = { canflip = true },
    corn = { canflip = true },
    cutreeds = { canflip = true },
    dragonfruit_cooked = { canflip = true },
    dragonfruit = { canflip = true },
    dreadstone = { canflip = true },
    driftwood_log = { canflip = true },
    durian_cooked = { canflip = true },
    durian = { canflip = true },
    eel = { canflip = true },
    eggplant_cooked = { canflip = true },
    fertilizer = { canflip = true },
    fishmeat = { canflip = true },
    furtuft = { canflip = true },
    garlic_cooked = { canflip = true },
    garlic = { canflip = true },
    gelblob_bottle = { canflip = true },
    glommerfuel = { canflip = true },
    glommerwings = { canflip = true },
    goatmilk = { canflip = true },
    guano = { canflip = true },
    gunpowder = { canflip = true },
    honey = { canflip = true },
    horn = { canflip = true },
    kelp_cooked = { canflip = true },
    kelp = { canflip = true },
    kelp_dried = { canflip = true },
    lavae_cocoon = { canflip = true },
    lightninggoathorn = { canflip = true },
    meat_dried = { canflip = true },
    messagebottle = { canflip = true },
    monstermeat_dried = { canflip = true },
    mosquitofertilizer = { canflip = true },
    nightmare_timepiece = { canflip = true },
    onion_cooked = { canflip = true },
    onion = { canflip = true },
    pepper_cooked = { canflip = true },
    phlegm = { canflip = true },
    pomegranate_cooked = { canflip = true },
    pomegranate = { canflip = true },
    poop = { canflip = true },
    potato_cooked = { canflip = true },
    potato = { canflip = true },
    pumpkin_cooked = { canflip = true },
    pumpkin = { canflip = true },
    rottenegg = { canflip = true },
    royal_jelly = { canflip = true },
    sewing_tape = { canflip = true },
    shroom_skin = { canflip = true },
    slurper_peltd = { canflip = true },
    slurtleslime = { canflip = true },
    smallmeat_dried = { canflip = true },
    soil_amender = { canflip = true },
    soil_amender_fermented = { canflip = true },
    spoiled_fish = { canflip = true },
    spoiled_fish_small = { canflip = true },
    spoiled_food = { canflip = true },
    steelwool = { canflip = true },
    succulent_picked = { canflip = true },
    tentaclespots = { canflip = true },
    thulecite = { canflip = true },
    thulecite_pieces = { canflip = true },
    tomato_cooked = { canflip = true },
    tomato = { canflip = true },
    treegrowthsolution = { canflip = true },
    voidcloth = { canflip = true },
    wagpunk_bits = { canflip = true },
    walrus_tusk = { canflip = true },
    wetgoop = { canflip = true },
    wormlight = { canflip = true },
    wx78module_bee = { canflip = true },
    wx78module_cold = { canflip = true },
    wx78module_heat = { canflip = true },
    wx78module_light = { canflip = true },
    wx78module_maxhealth2 = { canflip = true },
    wx78module_maxhealth = { canflip = true },
    wx78module_maxhunger1 = { canflip = true },
    wx78module_maxhunger = { canflip = true },
    wx78module_maxsanity1 = { canflip = true },
    wx78module_maxsanity = { canflip = true },
    wx78module_movespeed2 = { canflip = true },
    wx78module_movespeed = { canflip = true },
    wx78module_music = { canflip = true },
    wx78module_nightvision = { canflip = true },
    wx78module_taser = { canflip = true },
    singingshell_octave3 = {
        canflip = true,
        bank = "singingshell_octave_decoration",
    },
    singingshell_octave4 = {
        canflip = true,
        bank = "singingshell_octave_decoration",
    },
    singingshell_octave5 = {
        canflip = true,
        bank = "singingshell_octave_decoration",
    },
    lightbulb = {
        canflip = true,
        bloome_ffect = "shaders/anim.ksh",
        light = {
            falloff = 0.7,
            intensity = 0.5,
            radius = 0.5,
            colour = Vector3(237, 237, 209),
        },
    },
    shadowheart = { canflip = true },
    shadowheart_infused = {
        canflip = true,
        custom_animation_num_rots = 16,
    },
    nightmarefuel = {
        canflip = true,
        custom_animation_num_rots = 16,
        use_point_filtering = true,
        mult_colour = { 1, 1, 1, 0.5 },
    },
    horrorfuel = {
        canflip = true,
        custom_animation_num_rots = 16,
        use_point_filtering = true,
        mult_colour = { 1, 1, 1, 0.5 },
        anim = "shell",
        fn = function(inst, itemdata, flip, rot, isinfrontend)
            local animation = "core" .. (flip and itemdata.canflip and "_flip_" or "_") .. (rot - 1)
            if inst.core then
                inst.core.AnimState:PlayAnimation(animation, true)
                return
            end

            if TheWorld.ismastersim and not isinfrontend then
                inst.core = SpawnPrefab("horrorfuel_core_fx")
            else
                inst.core = CreateEntity()
                inst.core.persists = false
                if isinfrontend then
                    inst.core.entity:AddUITransform()
                else
                    inst.core.entity:AddTransform()
                end
                inst.core.entity:AddAnimState()
                inst.core.AnimState:SetBank(itemdata.bank)
                inst.core.AnimState:SetBuild(itemdata.build)
                inst.core.AnimState:SetFinalOffset(1)
            end

            inst.core.AnimState:PlayAnimation(animation, true)
            inst.core.AnimState:SetFrame(math.random(inst.core.AnimState:GetCurrentAnimationNumFrames()) - 1)

            inst.highlightchildren = { inst.core }
            inst.core.entity:SetParent(inst.entity)

            inst.AnimState:SetFrame(math.random(inst.AnimState:GetCurrentAnimationNumFrames()) - 1)
        end
    },
    purebrilliance = {
        canflip = true,
        custom_animation_num_rots = 16,
        use_point_filtering = true,
        bloome_ffect = "shaders/anim.ksh",
        fn = function(inst)
            inst.AnimState:SetSymbolLightOverride("pb_energy_loop", .5)
            inst.AnimState:SetSymbolLightOverride("pb_ray", .5)
            inst.AnimState:SetSymbolLightOverride("SparkleBit", .5)
            inst.AnimState:SetLightOverride(.1)
        end
    },
}

local winter_ornament_light_colours = {
    Vector3(255, 25.5, 25.5),
    Vector3(25.5, 255, 25.5),
    Vector3(127.5, 127.5, 255),
    Vector3(255, 255, 255),
    Vector3(255, 25.5, 25.5),
    Vector3(25.5, 255, 25.5),
    Vector3(127.5, 127.5, 255),
    Vector3(255, 255, 255),
}

local function winter_ornament_light_flash(inst, itemdata)
    inst.AnimState:OverrideSymbol("item", itemdata.build, "light_on")
    if not TheWorld.ismastersim then
        return
    end
    inst:DoPeriodicTask(1.2, function()
        local light = not inst.Light:IsEnabled()
        inst.AnimState:OverrideSymbol("item", itemdata.build, "light_" .. (light and "on" or "off"))
        inst.Light:Enable(light)
    end)
end

for i, colour in ipairs(winter_ornament_light_colours) do
    MoreDecorations["winter_ornament_light" .. i] = {
        canflip = true,
        bloome_ffect = "shaders/anim.ksh",
        light = {
            falloff = 0.7,
            intensity = 0.5,
            radius = 0.5,
            colour = colour,
        },
        fn = winter_ornament_light_flash
    }
end

return {
    SnowmanSkins = SnowmanSkins,
    MoreDecorations = MoreDecorations,
}
